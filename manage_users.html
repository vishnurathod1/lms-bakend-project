<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Manage Users</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="manage-users-page">
   
    <main class="manage-users-main">
        <h1>Manage Users</h1>
        <button class="add-user-btn" onclick="window.location.href='add_user.html'">Add New User</button>
        <table class="users-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Mobile No</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </main>
    <script>
        function getUsers() {
            const users = localStorage.getItem('users');
            return users ? JSON.parse(users) : [];
        }

        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function renderUsers() {
            const users = getUsers();
            const tbody = document.querySelector('.users-table tbody');
            tbody.innerHTML = '';
            users.forEach((user, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${user.status}</td>
                    <td>${user.phone || ''}</td>
                    <td>
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="delete-btn" data-index="${index}">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            attachEventListeners();
        }

        function attachEventListeners() {
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    openEditForm(index);
                });
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    deleteUser(index);
                });
            });
        }

        function openEditForm(index) {
            const users = getUsers();
            const user = users[index];
            const formHtml = `
                <div class="modal">
                    <div class="modal-content">
                        <h2>Edit User</h2>
                        <form id="user-form">
                            <input type="hidden" id="user-index" value="${index}" />
                            <div class="form-group">
                                <label for="name">Name:</label>
                                <input type="text" id="name" value="${user.name}" required />
                            </div>
                            <div class="form-group">
                                <label for="email">Email:</label>
                                <input type="email" id="email" value="${user.email}" required />
                            </div>
                            <div class="form-group">
                                <label for="role">Role:</label>
                                <select id="role" required>
                                    <option value="Student" ${user.role === 'Student' ? 'selected' : ''}>Student</option>
                                    <option value="Trainer" ${user.role === 'Trainer' ? 'selected' : ''}>Trainer</option>
                                    <option value="Admin" ${user.role === 'Admin' ? 'selected' : ''}>Admin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="status">Status:</label>
                                <select id="status" required>
                                    <option value="Active" ${user.status === 'Active' ? 'selected' : ''}>Active</option>
                                    <option value="Inactive" ${user.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="phone">Mobile No:</label>
                                <input type="text" id="phone" value="${user.phone || ''}" />
                            </div>
                            <button type="submit" class="submit-btn">Save</button>
                            <button type="button" id="cancel-btn" class="submit-btn">Cancel</button>
                        </form>
                    </div>
                </div>
            `;
            const main = document.querySelector('.manage-users-main');
            main.insertAdjacentHTML('beforeend', formHtml);
            document.getElementById('cancel-btn').addEventListener('click', closeForm);
            document.getElementById('user-form').addEventListener('submit', saveUser);
        }

        function closeForm() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }

        function saveUser(e) {
            e.preventDefault();
            const index = document.getElementById('user-index').value;
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const role = document.getElementById('role').value;
            const status = document.getElementById('status').value;
            const phone = document.getElementById('phone').value.trim();

            if (!name || !email) {
                alert('Name and Email are required.');
                return;
            }

            const users = getUsers();
            users[index] = { name, email, role, status, phone };
            saveUsers(users);
            closeForm();
            renderUsers();
        }

        function deleteUser(index) {
            if (confirm('Are you sure you want to delete this user?')) {
                const users = getUsers();
                users.splice(index, 1);
                saveUsers(users);
                renderUsers();
            }
        }

        // Initial render
        renderUsers();
    </script>
</body>
</html>
