<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>View Trainees</title>
    <link rel="stylesheet" href="view_trainees.css" />
</head>
<body class="view-trainees-page">
    <main class="view-trainees-main">
        <h1>View Trainees</h1>
        <button id="add-trainee-btn" class="add-user-btn">Add New Trainee</button>
        <table class="trainees-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Mobile No</th>
                    <th>Teaching subject</th>
                    <th>Actions</th>
                    
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </main>

    <div id="modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2 id="modal-title">Add Trainee</h2>
            <form id="trainee-form">
                <input type="hidden" id="trainee-index" value="" />
                <label for="name">Name:</label>
                <input type="text" id="name" required />
                <label for="email">Email:</label>
                <input type="email" id="email" required />
                <label for="status">Status:</label>
                <select id="status" required>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
                <label for="phone">Mobile No:</label>
                <input type="text" id="phone" />
                <label for="subject">Teaching Subject:</label>
                <input type="text" id="subject" />
                <button type="submit" class="submit-btn">Save</button>
                <button type="button" id="cancel-btn" class="submit-btn">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        function getUsers() {
            const users = localStorage.getItem('users');
            return users ? JSON.parse(users) : [];
        }

        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function renderTrainees() {
            const users = getUsers();
            const trainees = users.filter(user => user.role === 'Student');
            const tbody = document.querySelector('.trainees-table tbody');
            tbody.innerHTML = '';
            trainees.forEach((user, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.status}</td>
                    <td>${user.phone || ''}</td>
                    <td>${user.subject || ''}</td>
                    <td>
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="delete-btn" data-index="${index}">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            attachEventListeners();
        }

        function attachEventListeners() {
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    openEditForm(index);
                });
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    deleteTrainee(index);
                });
            });
        }

        function openEditForm(index) {
            const users = getUsers();
            const user = users.filter(u => u.role === 'Student')[index];
            if (!user) return;
            document.getElementById('modal-title').textContent = 'Edit Trainee';
            document.getElementById('trainee-index').value = index;
            document.getElementById('name').value = user.name;
            document.getElementById('email').value = user.email;
            document.getElementById('status').value = user.status;
            document.getElementById('phone').value = user.phone || '';
            document.getElementById('subject').value = user.subject || '';
            document.getElementById('modal').style.display = 'block';
        }

        function closeForm() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('trainee-form').reset();
            document.getElementById('trainee-index').value = '';
        }

        document.getElementById('cancel-btn').addEventListener('click', closeForm);

        document.getElementById('add-trainee-btn').addEventListener('click', () => {
            document.getElementById('modal-title').textContent = 'Add Trainee';
            document.getElementById('modal').style.display = 'block';
        });

        document.getElementById('trainee-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const index = document.getElementById('trainee-index').value;
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const status = document.getElementById('status').value;
            const phone = document.getElementById('phone').value.trim();
            const subject = document.getElementById('subject').value.trim();

            if (!name || !email) {
                alert('Name and Email are required.');
                return;
            }

            let users = getUsers();
            let trainees = users.filter(u => u.role === 'Student');

            if (index === '') {
                // Add new trainee
                trainees.push({ name, email, role: 'Student', status, phone, subject });
            } else {
                // Edit existing trainee
                trainees[index] = { name, email, role: 'Student', status, phone, subject };
            }

            // Remove old trainees and add updated list
            users = users.filter(u => u.role !== 'Student').concat(trainees);
            saveUsers(users);
            closeForm();
            renderTrainees();
        });

        function deleteTrainee(index) {
            if (confirm('Are you sure you want to delete this trainee?')) {
                let users = getUsers();
                let trainees = users.filter(u => u.role === 'Student');
                trainees.splice(index, 1);
                users = users.filter(u => u.role !== 'Student').concat(trainees);
                saveUsers(users);
                renderTrainees();
            }
        }

        // Initial render
        renderTrainees();

        window.onload = function() {
            const addSampleBtn = document.getElementById('add-sample-btn');
            if (addSampleBtn) {
                addSampleBtn.onclick = function() {
                    const sampleUsers = [
                        { name: 'Alice Johnson', email: 'alice@example.com', role: 'Student', status: 'Active', phone: '123-456-7890', subject: 'Mathematics' },
                        { name: 'Bob Smith', email: 'bob@example.com', role: 'Student', status: 'Active', phone: '234-567-8901', subject: 'Science' },
                        { name: 'Charlie Brown', email: 'charlie@example.com', role: 'Student', status: 'Inactive', phone: '345-678-9012', subject: 'History' },
                        { name: 'David Trainer', email: 'david@example.com', role: 'Trainer', status: 'Active', phone: '456-789-0123' },
                        { name: 'Eva Trainer', email: 'eva@example.com', role: 'Trainer', status: 'Active', phone: '567-890-1234' }
                    ];
                    let users = getUsers();
                    // Remove existing students and trainers to avoid duplicates
                    users = users.filter(user => user.role !== 'Student' && user.role !== 'Trainer');
                    users = users.concat(sampleUsers);
                    localStorage.setItem('users', JSON.stringify(users));
                    renderTrainees();
                };
            }
        };
    </script>
</body>
</html>
